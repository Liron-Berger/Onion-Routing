<!DOCTYPE html>
<html>
    <body>

        <head>
            <link rel="stylesheet" type="text/css" href="pagewrap.css">
            <link rel="stylesheet" type="text/css" href="menu.css">
            <title>Onion Routing</title>
        </head>

        <div id="myNav" class="overlay">
            <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
            <div class="overlay-content">
                <a href="/about.html">About</a>
                <a href="/statistics">Statistics</a>
                <a href="/register.html">Register</a>
                <a href="/instructions.html">Instructions</a>
            </div>
        </div>

        <span style="font-size:30px;cursor:pointer" onclick="openNav()">
            <img height="30" src="logo.png"></img>
            Menu
        </span>

        <script>
            function openNav() {
                document.getElementById("myNav").style.height = "100%";
            }

            function closeNav() {
                document.getElementById("myNav").style.height = "0%";
            }
        </script>


        <div id="pagewrap">
            <header>
                <center>
                    <h1>Onion Routing</h1>
                </center>
            </header>

            <section id="content">
                <h2>New Node Sign Up</h2>
            <form action="register">
                Node Name:<br>
                <input type="text" name="name">
                <br>
                Bind Address:<br>
                <input type="text" name="address">
                <br>
                Bind Port:<br>
                <input type="text" name="port">
                <br><br>
                <input type="submit" value="Register">
            </form>
            </section>

            <section id="middle">
                <h2>
                    <center>
                    Statistics
                    </center>
                </h2>
                <table width=690 cellpadding="4" cellspacing="3">
                    <tr>
                        <td>
                            <table cellspacing="3" cellpadding="4" width="690" border = "5">
                                <th id="connection_number" colspan="5"></th>
                            </table>
                        </td>
                    </tr>
                  
                    <tr>
                        <td>
                            <div style="width:690; height:500px; overflow:auto;">
                                <table id="demo" cellspacing="3" cellpadding="4" width="690" border = "1">
                                </table>
                            </div>
                        </td>
                    </tr>
                </table>
            </section>

            <aside id="sidebar">
                <center>
                    <h2>Existing Nodes</h2>
                    <table>
                        %s
                    </table>
                </center>
            </aside>

            <footer>
                <h4>Onion Chain Visualizer</h4>
                <p>Coming soon...</p>
            </footer>
        </div>

        <script>
            loadXMLDoc()
            setInterval(loadXMLDoc, 1000);

            function loadXMLDoc() {
                var xhttp = new XMLHttpRequest();
            
                xhttp.onreadystatechange = function() {
                    if (this.readyState == 4 && this.status == 200) {
                        parseXML(this);
                    }
                };
                xhttp.open("GET", "statistics.xml", false);
                xhttp.send();
            }

            function parseXML(xml) {
                var i;
                var parser = new DOMParser();
                var xmlDoc = parser.parseFromString(xml.responseText, "application/xml");
                
                document.getElementById("connection_number").innerHTML = "Connections: " + xmlDoc.getElementsByTagName("connection_number")[0].childNodes[0].nodeValue
                
                table = '<tr><th> </th><th> Socket Type </th><th> Socket File Descriptor </th><th> Bytes </th><th> </th></tr>'
                
                var x = xmlDoc.getElementsByTagName("connection");
                for (i = 0; i < x.length; i++) {
                    table += 
                        '<tr align="center">' +
                            '<td rowspan="2">' + (i+1) + '</td>' +
                            '<td> server </td>' +
                            '<td>' + x[i].getElementsByTagName("server")[0].childNodes[0].nodeValue + '</td>' +
                            '<td>' + x[i].getElementsByTagName("in")[0].childNodes[0].nodeValue + '</td>' +
                            '<td rowspan="2">' +
                                '<button type="button" onclick="location.href=\'/disconnect?connection=' + x[i].getElementsByTagName("num")[0].childNodes[0].nodeValue + '\';">' +
                                '    Disconnect' +
                                '</button>' +
                            '</td>' +
                        '</tr>' +
                        '<tr align="center">' +
                            '<td> partner </td>' +
                            '<td>' + x[i].getElementsByTagName("partner")[0].childNodes[0].nodeValue + '</td>' +
                            '<td>' + x[i].getElementsByTagName("out")[0].childNodes[0].nodeValue + '</td>' +
                        '</tr>'
                    ;
                }
                document.getElementById("demo").innerHTML = table;
            }
        </script>

    </body>
</html>
